---
sidebar_position: 1
image: https://i.imgur.com/M3ry11P.png
---

# ComfyUI | å¦‚ä½•å¤åˆ»ç²˜åœŸé£æ ¼æ»¤é•œ

å¦‚ä½•åœ¨`LooPIN`ä¸Šä¸€é”®éƒ¨ç½²`Stable Diffusion`çš„`Comfy UI`ï¼Œä»¥åŠåˆæ­¥ä½“éªŒä½¿ç”¨ç²˜åœŸé£æ ¼æ»¤é•œã€‚`Comfy UI`é‡‡ç”¨èŠ‚ç‚¹åŒ–æ“ä½œï¼Œå¯æ§æ€§æ›´é«˜ï¼Œæ›´å®¹æ˜“å¤ç°å’Œå¾®è°ƒå‡ºå›¾ç»“æœï¼Œç†Ÿç»ƒä¹‹åè¿˜å¯ä»¥å®šåˆ¶ä¸ªæ€§åŒ–å·¥ä½œæµã€‚

> ğŸ”¥NEWğŸ”¥ å¦‚æœä½ æƒ³å…ˆè¯•è¯•æ•ˆæœï¼Œå¯ä»¥å…ˆä½¿ç”¨æˆ‘ä»¬çš„AIç²˜åœŸé£æ ¼æ»¤é•œ: ğŸ‘‰ğŸ» <a href="/playground/comfyui-clay-demo" target="_blank">Clay Style Demo</a>

![comfyUI-clay-style-tutorial](comfyUI.assets/comfyUI-clay-style-tutorial.webp)

## ComfyUI ç®€ä»‹

`Comfy UI`é‡‡ç”¨èŠ‚ç‚¹åŒ–æ“ä½œã€‚ä¸å…¶ä»–WebUIç›¸æ¯”ï¼Œå®ƒç›®å‰å¯¹`Stable Diffusion XL 1.0`æ¨¡å‹çš„æ”¯æŒæ›´å¥½ï¼Œå¯ä»¥åœ¨å·¥ä½œæµä¸­ç›´è§‚çœ‹åˆ°ä½¿ç”¨ä¸åŒæ¨¡å‹ï¼ˆå¦‚Baseæ¨¡å‹ã€Refinerç²¾ç‚¼æ¨¡å‹ï¼‰ç”Ÿæˆçš„æ•ˆæœå›¾ã€‚èŠ‚ç‚¹åŒ–çš„æ“ä½œæ–¹å¼å¸¦æ¥äº†æ›´é«˜çš„å¯æ§æ€§ï¼Œä¾¿äºå¤ç°å’Œå¾®è°ƒå‡ºå›¾ç»“æœï¼Œç†Ÿç»ƒåè¿˜èƒ½å®šåˆ¶ä¸ªæ€§åŒ–çš„å·¥ä½œæµç¨‹ã€‚

![playground-demo-comfyui-clay](comfyUI.assets/playground-demo-comfyui-clay.png)

## ComfyUI èŠ‚ç‚¹å®‰è£…

### é…ç½®GPUå®ä¾‹

è¯·è®¿é—®ä»¥ä¸‹é¡µé¢ï¼Œè·å¾—è¯¦ç»†çš„äº¤äº’å¼æŒ‡å¯¼ï¼š[LooPINæµåŠ¨æ€§æ± ](/docs/quick-start/swap)

**1. LooPINæµåŠ¨æ€§æ± ï¼š**

å‰å¾€LooPINçš„æµåŠ¨æ€§æ± ï¼ˆ[LooPIN Network Pool](https://loopin.network/pool)ï¼‰ï¼Œä½¿ç”¨$LOOPINä»£å¸è´­ä¹°GPUæ—¶é—´ã€‚ä»¥RTX 3080 GPUä¸ºä¾‹ï¼Œæ ¹æ®è‡ªèº«éœ€æ±‚å’Œé¢„ç®—ï¼Œåœ¨[GPU UserBenchmark](https://gpu.userbenchmark.com/) ä¸­é€‰æ‹©åˆé€‚çš„GPUå‹å·ã€‚

**2. ä»£å¸å…‘æ¢GPUèµ„æºï¼š**

- é€‰æ‹©æ‰€éœ€çš„$LOOPINä»£å¸æ•°é‡ã€‚
- é€šè¿‡æ»‘å—é€‰æ‹©GPUæ•°é‡ã€‚
- ç¡®è®¤å…‘æ¢é‡å¹¶å®Œæˆäº¤æ˜“ã€‚

**3. è¿›å…¥Jupyter Notebookï¼š**

äº¤æ˜“æˆåŠŸåï¼Œè¿›å…¥**Rented Servers**ä¸‹çš„**Server**åŒºåŸŸï¼Œé€šè¿‡ä½ çš„è¿œç¨‹æœåŠ¡å™¨è®¿é—®Jupyter Notebookã€‚é€šå¸¸ï¼Œå®ä¾‹å¯åŠ¨éœ€è¦2-4åˆ†é’Ÿã€‚

**4. ç”¨nvidia-smiéªŒè¯GPUï¼š**

åœ¨Jupyter Notebookä¸­ï¼Œæ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ï¼Œè¿è¡Œnvidia-smiå‘½ä»¤ï¼Œæ£€æŸ¥GPUæ˜¯å¦å·²æ¿€æ´»ã€‚

```shell
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA GeForce RTX 3080        Off |   00000000:01:00.0 Off |                  N/A |
|  0%   39C    P8             21W /  350W |      12MiB /  12288MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
+-----------------------------------------------------------------------------------------+
```

### ComfyUI å®‰è£…æµç¨‹

1. å®‰è£…`Comfy UI` githubåŒ…

```shell
git clone https://github.com/comfyanonymous/ComfyUI.git && cd ComfyUI
```

2. å®‰è£…pythonä¾èµ–

```shell
pip install xformers!=0.0.18 -r requirements.txt --extra-index-url https://download.pytorch.org/whl/cu121 --extra-index-url https://download.pytorch.org/whl/cu118 --extra-index-url https://download.pytorch.org/whl/cu117
```

3. å®‰è£…`ComfyUI-manager`

`ComfyUI-Manager` æ˜¯ä¸€ä¸ªç”¨æ¥æå‡ `Comfy UI `ç”¨æˆ·ä½“éªŒçš„æ‰©å±•ã€‚å®ƒå¸¦æœ‰ä¸€å¥—ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥å®‰è£…ã€ç§»é™¤ã€ç¦ç”¨ä»¥åŠå¯ç”¨ `Comfy UI` çš„å„ç±»å®šåˆ¶èŠ‚ç‚¹ã€‚

```shell
cd /workspace/ComfyUI/custom_nodes
git clone https://github.com/ltdrdata/ComfyUI-Manager.git
```

4. ä¸‹è½½Cloudflare tunnel

```shell
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
dpkg -i cloudflared-linux-amd64.deb
```

5. åœ¨`Comfy UI`ä¸‹æ–°å»º`Jupyter Notebook`ï¼Œä½¿ç”¨`Cloudflare`æš´éœ²ç«¯å£

```python
import subprocess
import threading
import time
import socket
import urllib.request

def iframe_thread(port):
  while True:
      time.sleep(0.5)
      sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
      result = sock.connect_ex(('127.0.0.1', port))
      if result == 0:
        break
      sock.close()
  print("\nComfyUI finished loading, trying to launch cloudflared (if it gets stuck here cloudflared is having issues)\n")

  p = subprocess.Popen(["cloudflared", "tunnel", "--url", "http://127.0.0.1:{}".format(port)], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
  for line in p.stderr:
    l = line.decode()
    if "trycloudflare.com " in l:
      print("This is the URL to access ComfyUI:", l[l.find("http"):], end='')
    #print(l, end='')


threading.Thread(target=iframe_thread, daemon=True, args=(8188,)).start()

!python main.py --dont-print-server
```

ç­‰å¾…`Cloudflare`è¾“å‡ºå†…ç½‘ç©¿é€çš„è¿æ¥

```shell
xformers version: 0.0.26.post1+cu118
Set vram state to: NORMAL_VRAM
Device: cuda:0 NVIDIA GeForce RTX 3080 : cudaMallocAsync
VAE dtype: torch.bfloat16
Using pytorch cross attention
****** User settings have been changed to be stored on the server instead of browser storage. ******
****** For multi-user setups add the --multi-user CLI argument to enable multiple user profiles. ******

Import times for custom nodes:
   0.0 seconds: /workspace/ComfyUI/custom_nodes/websocket_image_save.py


ComfyUI finished loading, trying to launch cloudflared (if it gets stuck here cloudflared is having issues)

This is the URL to access ComfyUI: https://inside-isa-myrtle-guardian.trycloudflare.com
```

ç‚¹å‡»è¿™ä¸ªé“¾æ¥å³å¯è¿›å…¥ComfyUI `https://inside-isa-myrtle-guardian.trycloudflare.com`ï¼Œå¦‚æœåŠ è½½ä¸å‡ºæ¥ï¼Œä¸€èˆ¬éœ€è¦ç­‰å¾…1-2min

![comfyUI-overview](comfyUI.assets/comfyUI-overview.png)

### ç²˜åœŸé£æ ¼å·¥ä½œæµå®‰è£…

1. åŠ è½½ç²˜åœŸé£æ ¼å·¥ä½œæµ

æˆ‘ä»¬é‡‡ç”¨`XIONGMU`çš„å¼€æºçš„`Comfy UI`å·¥ä½œæµ (https://openart.ai/workflows/xiongmu/image-to-clay-style/KRjSiOFyPSHO5QCQ4raV)

ç‚¹å‡»ä¸‹è½½åï¼Œåœ¨`Comfy UI`é€‰æ‹©LoadåŠ è½½

![how-to-install-missing-nodes-in-comfyUI](comfyUI.assets/how-to-install-missing-nodes-in-comfyUI.png)

æ­¤æ—¶å› ä¸ºå¾ˆå¤šèŠ‚ç‚¹æˆ‘ä»¬è¿˜æ²¡å®‰è£…ï¼Œæ‰€ä»¥æŠ¥é”™ï¼Œæ­¤æ—¶æ‰“å¼€å³ä¸‹è§’çš„Managerï¼Œç‚¹å‡»`Install Missing Custom Nodes`ï¼Œç„¶åä¸€ä¸ªä¸ªç‚¹å‡»`Install`å³å¯å…¨éƒ¨å®‰è£…ï¼ˆæ­¤æ•™ç¨‹ä¸­å…±æœ‰11ä¸ªcustom nodeéœ€è¦å®‰è£…ï¼‰ï¼Œå®‰è£…å®Œæˆåç‚¹å‡»`restart`å¯é‡å¯`Comfy UI`

2. ä¸‹è½½`Checkpoint`åŸºç¡€æ¨¡å‹

æˆ‘ä»¬åœ¨è¿™ä½¿ç”¨`https://huggingface.co/RunDiffusion/Juggernaut-XL-v9/resolve/main/Juggernaut-XL_v9_RunDiffusionPhoto_v2.safetensors?download=true`

> ä¸­å›½ç”¨æˆ·è¯·å°†`https://huggingface.co`æ›¿æ¢æˆ`https://hf-mirror.com/`

```
wget https://huggingface.co/RunDiffusion/Juggernaut-XL-v9/resolve/main/Juggernaut-XL_v9_RunDiffusionPhoto_v2.safetensors -O /workspace/ComfyUI/models/checkpoints/Juggernaut-XL_v9_RunDiffusionPhoto_v2.safetensors
```

3. ä¸‹è½½`Lora`æ¨¡å‹

`LoRA`æ˜¯ä¸€ç§fine tuneæ‰©æ•£æ¨¡å‹çš„è®­ç»ƒæŠ€æœ¯ã€‚é€šè¿‡å¯¹æ ‡å‡†çš„checkpointæ¨¡å‹åšå¾®å°çš„ä¿®æ”¹ï¼Œå¯ä»¥æ¯”checkpointæ¨¡å‹å°10åˆ°100å€ã€‚é‡‡ç”¨ä¸åŒçš„Loraå¯ä»¥å°†åŸºç¡€æ¨¡å‹å±€éƒ¨å¢å¼ºï¼Œä½¿å…¶ç”Ÿæˆé£æ ¼åŒ–çš„å›¾ç‰‡ã€‚

æˆ‘ä»¬è¿™é‡Œéœ€è¦ä¸¤ä¸ªLora

- CLAYMATE - Claymation Style for SDXL

![claymation_lora_comfyui](comfyUI.assets/claymation_lora_comfyui.png)

`https://civitai.com/models/208168/claymate-claymation-style-for-sdxl`

- Doctor Diffusion's Claymation Style LoRA

![doctor-diffusion-claymation-lora_comfyui](comfyUI.assets/doctor-diffusion-claymation-lora_comfyui.png)

`https://civitai.com/models/181962/doctor-diffusions-claymation-style-lora`

é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤ä¸€é”®ä¸‹è½½ï¼ˆæˆ‘ä»¬åœ¨`LooPIN`ç½‘ç»œæä¾›å…è´¹é•œåƒåŠ é€Ÿï¼‰

```shell
wget -c https://files.loopin.network/docs/tutorials/comfyui/DD-made-of-clay-XL-v2.safetensors -O /workspace/ComfyUI/models/loras/DD-made-of-clay-XL-v2.safetensors
wget -c https://files.loopin.network/docs/tutorials/comfyui/CLAYMATE_V2.03_.safetensors -O /workspace/ComfyUI/models/loras/CLAYMATE_V2.03_.safetensors
```

4. ä¸‹è½½Controlnetæ¨¡å‹

`ControlNet`çš„ä½œç”¨æ˜¯é€šè¿‡æ·»åŠ é¢å¤–æ§åˆ¶æ¡ä»¶ï¼Œæ¥å¼•å¯¼Stable Diffusion æŒ‰ç…§åˆ›ä½œè€…çš„åˆ›ä½œæ€è·¯ç”Ÿæˆå›¾åƒï¼Œä»è€Œæå‡AI å›¾åƒç”Ÿæˆçš„å¯æ§æ€§å’Œç²¾åº¦ã€‚

> ä¸­å›½ç”¨æˆ·è¯·å°†`https://huggingface.co`æ›¿æ¢æˆ`https://hf-mirror.com/`

```shell
wget https://huggingface.co/stabilityai/control-lora/resolve/main/control-LoRAs-rank256/control-lora-canny-rank256.safetensors -O /workspace/ComfyUI/models/controlnet/sai_xl_canny_256lora.safetensors
```

5. ä¸‹è½½IPAdapteræ¨¡å‹

`IPAdapter`ä¸ç”¨è®­ç»ƒloraï¼Œä¸€å¼ å›¾å°±èƒ½å®ç°é£æ ¼è¿ç§»ï¼Œè¿˜æ”¯æŒå¤šå›¾å¤šç‰¹å¾æå–ï¼ŒåŒæ—¶å¼ºå¤§çš„æ‹“å±•èƒ½åŠ›è¿˜å¯æ¥å…¥åŠ¨æ€promptçŸ©é˜µã€controlnetç­‰ç­‰ï¼Œè¿™å°±æ˜¯IP-Adapterï¼Œä¸€ç§å…¨æ–°çš„â€œå«å›¾â€æ–¹å¼ã€‚

> ä¸­å›½ç”¨æˆ·è¯·å°†`https://huggingface.co`æ›¿æ¢æˆ`https://hf-mirror.com/`

```
mkdir /workspace/ComfyUI/models/ipadapter
wget https://huggingface.co/h94/IP-Adapter/resolve/main/sdxl_models/ip-adapter_sdxl_vit-h.safetensors -O /workspace/ComfyUI/models/ipadapter/ip-adapter_sdxl_vit-h.safetensors
wget https://huggingface.co/h94/IP-Adapter/resolve/main/sdxl_models/ip-adapter-plus_sdxl_vit-h.safetensors -O /workspace/ComfyUI/models/ipadapter/ip-adapter-plus_sdxl_vit-h.safetensors
wget https://huggingface.co/h94/IP-Adapter/resolve/main/sdxl_models/ip-adapter-plus-face_sdxl_vit-h.safetensors -O /workspace/ComfyUI/models/ipadapter/ip-adapter-plus-face_sdxl_vit-h.safetensors
wget https://huggingface.co/h94/IP-Adapter/resolve/main/sdxl_models/ip-adapter_sdxl.safetensors -O /workspace/ComfyUI/models/ipadapter/ip-adapter_sdxl.safetensors
```

6. ä¸‹è½½ClipVisionæ¨¡å‹

> ä¸­å›½ç”¨æˆ·è¯·å°†`https://huggingface.co`æ›¿æ¢æˆ`https://hf-mirror.com/`

```
wget https://huggingface.co/h94/IP-Adapter/resolve/main/models/image_encoder/model.safetensors -O /workspace/ComfyUI/models/clip_vision/CLIP-ViT-H-14-laion2B-s32B-b79K.safetensors && wget https://huggingface.co/h94/IP-Adapter/resolve/main/sdxl_models/image_encoder/model.safetensors -O /workspace/ComfyUI/models/clip_vision/CLIP-ViT-bigG-14-laion2B-39B-b160k.safetensors
```

å®‰è£…å®Œæ¯•åï¼Œç‚¹å‡»Manager - Restart é‡å¯ ComfyUI

## ä½¿ç”¨ComfyUIç”Ÿæˆæµ‹è¯•å›¾ç‰‡

![comfyUI-clay-style-overview](comfyUI.assets/comfyUI-clay-style-overview.png)

åœ¨`ComfyUI`ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šæ–¹å±ç²˜åœŸé£æ ¼çš„å›¾ç‰‡å±•ç¤ºæ¡†ï¼Œä¸ºäº†æµ‹è¯•éƒ¨ç½²æ˜¯å¦æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. åœ¨Load Imageå¤„ç‚¹å‡»`choose file to upload`ä¸Šä¼ åŸå§‹å›¾ç‰‡
2. ç‚¹å‡»å³ä¾§çš„`Queue Prompt`æŒ‰é’®å¼€å§‹ç”Ÿæˆå›¾ç‰‡
3. ç­‰å¾…5-10ç§’å·¦å³ï¼Œç”Ÿæˆçš„å›¾ç‰‡ä¼šæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š

å¦‚æœå›¾ç‰‡æˆåŠŸç”Ÿæˆï¼Œåˆ™è¯´æ˜`ComfyUI`å·²ç»å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚

## æ€»ç»“ä¸å±•æœ›

æœ¬æœŸæ•™ç¨‹ä»‹ç»äº†å¦‚ä½•åœ¨LooPINå»ä¸­å¿ƒåŒ–GPUäº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²Stable Diffusionçš„ComfyUIï¼Œå¹¶åˆæ­¥ä½“éªŒäº†åŠ è½½ä½¿ç”¨ç²˜åœŸé£æ ¼æ¨¡å‹çš„æ•ˆæœã€‚åœ¨åç»­çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ComfyUIçš„æ›´å¤šç©æ³•å’Œåº”ç”¨ã€‚

`æœ¬æ–‡æ›´æ–°äº 2024å¹´5æœˆ9æ—¥`